@page "/CadastroCliente"
@page "/CadastroCliente/{codCliente}"
@inject IJSRuntime jsRuntime

@using Projeto_Contabilidade.Client.Pages.cliente
@using Projeto_Contabilidade.Client.Componentes.Steper
@using Projeto_Contabilidade.Client.Componentes.Input
@using Projeto_Contabilidade.Client.Componentes.Botao

<div class="card">
    <h4 class="card-header">Cadastro de Cliente</h4>
    <div class="card-body">

        <EditForm Model="vmCliente">
            <Steper Texto1="@texto1" Texto2="@texto2" OnStepChanged="OnStepChanged">
                <Step Text="Informações Gerais" Icon="oi-info" Value="Step1" Enabled="@IsEnabled">
                    <div class="form__div">
                        <h3 class="form__title">
                            Informações Gerais
                        </h3>
                        <div class="form__inputs">
                            <div class="field__control">
                                <label>Nome</label>
                                <InputText class="field__input field__input--active" @bind-Value="vmCliente.Nome_Cliente"></InputText>
                            </div>
                            <div class="field__control">
                                <label>CNPJ</label>
                                <InputText class="field__input field__input--active" @bind-Value="vmCliente.Cnpj"></InputText>
                            </div>
                            <div class="field__control">
                                <label>E-Mail</label>
                                <InputText class="field__input field__input--active" @bind-Value="vmCliente.Email"></InputText>
                            </div>
                            <div class="field__control">
                                <label>IE</label>
                                <InputText class="field__input field__input--active" @bind-Value="vmCliente.Ie"></InputText>
                            </div>
                        </div>
                    </div>
                </Step>
                <Step Text="Informações de Endereço" Icon="oi-location" Value="Step2" Enabled="@IsEnabled">
                    <div class="form__div">
                        <h3 class="form__title">
                            Informações De Endereço
                        </h3>
                        <div class="form__inputs">
                            <div class="field__control">
                                <label>CEP</label>
                                <InputText class="field__input field__input--active" @bind-Value="vmCliente.Cep"></InputText>
                            </div>
                            <div class="field__control">
                                <label>UF</label>
                                <InputText class="field__input field__input--active" @bind-Value="vmCliente.Uf"></InputText>
                            </div>
                            <div class="field__control">
                                <label>Bairro</label>
                                <InputText class="field__input field__input--active" @bind-Value="vmCliente.Bairro"></InputText>
                            </div>
                            <div class="field__control">
                                <label>Rua</label>
                                <InputText class="field__input field__input--active" @bind-Value="vmCliente.Rua"></InputText>
                            </div>
                        </div>
                    </div>
                </Step>
            </Steper>
        </EditForm>

    </div>
</div>

@code {

    public string texto1 = "Teste1";
    public string texto2 = "Teste2";
    public bool IsEnabled = true;

    [Parameter] public string codCliente { get; set; }
    ClienteViewModel vmCliente = new ClienteViewModel();
    private bool loading;
    private string error;

    protected override async Task OnInitializedAsync()
    {
        //Inicialização da Página
    }

    private async Task CadastrarCliente()
    {
        try
        {
            string url = $"Cliente/Gravar";
            HttpRequestMessage requestMessage = new HttpRequestMessage(HttpMethod.Post, url);
            // string jsonCorpo = UtilJson.SerializarObjetoParaJsonUTF8NewtonSoft(cliente);
            string jsonCorpo = System.Text.Json.JsonSerializer.Serialize(vmCliente);
            //requestMessage.Content = new StringContent(jsonCorpo, Encoding.UTF8, "application/json");
            //var resposta = await client.SendAsync(requestMessage);

            //if (resposta.IsSuccessStatusCode)
            //{

            //    LimparTela();

            //}
            //else
            //{

            //}

        }
        catch (InvalidOperationException ex)
        {
            throw new InvalidOperationException(ex.Message);
        }
    }

    public async Task OnStepChanged(Step step)
    {
        texto1 = $"Step value: {step.Value}";
        texto2 = $"Step text: {step.Text}";
    }


    public void LimparTela()
    {
        vmCliente.Nome_Cliente = "";
        vmCliente.Cnpj = "";
        vmCliente.Ie = "";
        vmCliente.Email = "";
        vmCliente.Rua = "";
        vmCliente.Numero = "";
        vmCliente.Bairro = "";
        vmCliente.Cep = "";
        vmCliente.Uf = "";
        vmCliente.vmCidade.Nome_Cidade = "";
    }

}
